# JS 异步，事件循环，消息队列，微任务和宏任务

JS 是单线程的，所谓单线程是指解释和执行JS代码的线程只有一个，这里我们叫做主线程，但是实际上还存在其他线程： 处理 ajax 线上，处理 dom 交互线程，定时器交互线程。
当主线程遇到 计时器 DOM 事件，http 请求，主线程会把他们交给浏览器其他线程，然后继续执行其他任务，这就是异步非阻塞。等其他线程处理完之后，会把对应的回调函数交给消息队列。主线程会去 消息队列取出任务并执行。

- 所有同步任务都是在主线程中执行的，形成了一个执行栈
- 主线程之外，还有一个消息队列，所有异步任务的回调函数都都放在消息队列之中
- 一旦执行栈中的同步任务执行完之后，系统就会去读取消息队列中的任务。
- 主线程不断重复上面三步，
只要主线程的执行栈空了，就回去读取任务队列。这个过程会不断重复，这就是事件循环。
消息队列又分为宏任务和微任务

## 微任务和宏任务
都是先进先出， 
- 宏任务
一个 事件循环有一个或多个 task 队列。总体来说 task 任务源有
- script 整体代码
- setTimeout
- setInterval
- setImemediate
- I/O
- requesteAnimation
- Dom render


- 微任务
一个事件循环只有一个 微任务队列。主要有
- promise
- process.nextTick
- Object.observe
- MutationObserve

宏任务队列可以有多个，但是微任务队列只有一个，所以每次执行 setTimeout 都是一个新的宏任务队列。执行完一个宏任务队列后，都会去 checkout 微任务队列
- 一个事件循环后，微任务执行完了，再去执行宏任务队列
- 一个事件循环中，执行完一个宏队列，就会去 checkout 微队列